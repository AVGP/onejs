import math
import gl
import glscene
import constraint

// my first scenegraph!
define circle(vec3 col, vec2 p, float pw){
	return mix(vec4(#black,0),vec4(col,1),clamp(1.-length(p) ** pw,0.,1.))
}

Scene{
	antialias = true
	fill = #aero
	Layer{
		dump = 1
		x = 100, y = 100, w = 400, h = 400
		rz: -Time.sec
		tex = Image.url('test_texture.jpg')
		pixel: tex.sample(p)
		Layer{
			rz: sin(Time.sec * 5)
			x = 0, y = 0
			sx = 1
			pixel:mix(#red, #green, p.y)
			var last
			for(var i = 0;i<100;i++){
				var win = Layer{
					w = 100
					h = 100
					rz: 0.2*sin(Time.sec)
					x = 10
					pixel:circle(mix(#red,#green,i/100.), hp, (100-i)*0.01*max(w,h))
				}
				if(last)win.parent = last
				last = win
			}
		}
	}
}