#js
var assert = load('assert')

TestClasses::{
	out("ONE::Classes")
	C1::{}
	Der1::C1{ x = assert.callOnce(1) }
	Der2::C1{ x = assert.callOnce(2) }
	Der3::Der1{}

	d1 = Der1.new()
	d2 = Der2.new()
	d3 = Der3.new()
	d1.x()
	d2.x()
}

Test1::{
	out("ONE::Roles")

	Role1::{ a = 20 }
	Role2::{ a = 30 }
	Role3 = ->{ a = 40, b = 50 }
	C1::{ a = 10 }

	var x = C1.new()
	C1.learn(Role1)
	C1.learn(Role2) 
	C1.learn(Role3)
	assert(x.a == 40)

	C1.forget(Role2)
	assert(x.a == 40)

	C1.forget(Role3)
	assert(x.a == 20)

	C1.forget(Role1)
	assert(x.a == 10)

	C1.learn(Role3)
	assert(x.a == 40)
	assert(x.b == 50)

	C1.forget(Role3)
	assert(x.b === undefined)

	Proto1::Role1{}
	proto = Proto1.new()
	proto.a == 20
	proto.hasOwnProperty('a') == false
	var p = Object.getPrototypeOf(proto)
	p.hasOwnProperty('a') == false
	p = Object.getPrototypeOf(p)
	p.hasOwnProperty('a') == true

}